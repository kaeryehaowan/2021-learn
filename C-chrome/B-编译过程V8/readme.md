## V8 是什么？
V8 是一个由 Google 开发的开源 JavaScript 引擎，目前用在 Chrome 浏览器和 Node.js 中，其核心功能是执行易于人类理解的 JavaScript 代码。V8是混合了 编译执行与解释执行 两种方式，称为 JIT(just in time)。所以V8也是虚拟机

## 编译流水线
1. 初始化基础环境
    - 堆空间
    - 栈空间
    - 全局执行上下文
        - 变量环境(管理 var function 声明的变量)
        - 词法环境(管理 let const class import 声明的变量)
        - this值
        - 外部环境
    - 全局作用域
    - 消息循环系统
    - 内置函数
    - 宿主提供的扩展函数(WebApi、NodeApi)
    - 对象
1. 分词
    - 词法分析
    - 语法分析
2. 生成 AST 与 作用域
    - 作用域就是把在上下文里能访问到的变量整合到一起，方便查找。因为上下文里会有一个[[__outer__]]的外部环境指针，在作用域里通过这个指针访问外层作用域，所以形成了作用域链。
3. 解释器生成字节码
    - 解释器（lgnition）
4. 如果是热点代码，则交给编译器生成机器码

## 事件循环系统
- 消息驱动器
- 消息队列
    - 从消息队列中取事件并执行事件为一个任务。

## 垃圾回收机制
- 代际假说
- 新生代：小、时长短
- 老生代：大、存活长
- 主回收器：负责老生代
- 副回收器：负责新生代
- 标记清除
- 引用清除



- 源码 -> AST(同时会生成作用域) -> 字节码 -> 机器代码
- 解析是惰性解析，V8并不会一次性把所有代码都解析成字节码，因为全部解析会增加等待时间和内存占用。虽然会惰性解析，但是V8还是会有一个预解析器来对函数内部代码进行一个快速扫描，主要是为了识别有语法错误，另一个就是识别是否有闭包，如果有闭包，那就把闭包里变量复制到堆中，下次用到这个变量时，就直接引用堆中的变量，这样就不影响上级调用栈的退出和销毁。
- 字节码可以被解释器解释执行，也可以被编译器编译为二进制机器码再执行。先进行解释执行，当一段代码被多次执行，则会被标记为热点代码，热点代码会被传给优化编译器，后续被编译成优化后的二进制码，再执行这段代码时，V8就会使用二进制码。这样执行速度就大幅提升。
- 对象是什么？
 1. js中，对象是一些属性与值（键值对）的集合。从使用的直觉上讲，对象就像一个字典，字符串作为键名，任意对象作为键值，再通过键名读写。

 2. 对象会有4个隐藏属性： __proto__、map、elements 与 properties，__proto__是原型，map是隐藏类， elements属性指向elements对象，这个对象会按照键名顺序排序；properties属性指向properties对象，这个对象会按照创建时间排序；V8在处理对象时，会允许在对象本身内置10个properties属性，超出的就会放到properties对象里。内置的10个properties属性是对象内属性，elements对象里的是快属性。properties对象里的是字典结构，是慢属性。访问最快的是内属性，其次是多了一次寻址的快属性，最后是字典的慢属性。

 3. 函数对象除了拥有常用类型的属性值外，还有隐藏属性： name、code、prototype
    - name，为函数名，匿名函数的name为anonymous
    - code，为函数代码，以字符串的形式存储在内存中。当函数对象被调用时，V8会通过访问code属性从内存中取得函数代码再解释执行。
    - 函数声明与函数表达式
    - 在编译阶段，将所有的变量提升到作用域的过程称为 **变量提升**。
    - 原型链：沿着以对象的__proto__属性查找的路径，就是原型链。
    - 函数是在执行时才被编译再执行。
    - 全局作用域是在 V8 启动过程中就创建了，且一直保存在内存中不会被销毁的，直至 V8 退出。 而函数作用域是在执行该函数时创建的，当函数执行结束之后，函数作用域就随之被销毁掉了
    - js是基于词法作用域的，就是指查找作用域的顺序是按照函数定义时的位置来决定的！！！，同时，词法作用域也称静态作用域。
    - 作用域链：就是基于词法作用域一级级查找的路径。
    - this是为了弥补没有动态作用域而出现的。
4. 对象的最佳实践
    - 使用字面量初始化对象时，要保证属性的顺序是一致的。这是为了对象之间共用一个隐藏类map。
    - 尽量使用字面量一次性初始化完整对象属性。尽量不要在后面为对象新增属性或改变属性类型。
    - 尽量避免使用 delete 方法。尽量不要删除属性。
- V8 实现ECMAScript标准，浏览器是V8的宿主环境，浏览器启动一个渲染进程就会初始化一个V8实例，同时初始化堆空间与栈空间。
    1. 栈空间主要是用来管理 JavaScript 函数调用的，栈是内存中连续的一块空间，同时栈结构是“先进后出”的策略。在函数调用过程中，涉及到上下文相关的内容都会存放在栈上，比如原生类型、引用到的对象的地址、函数的执行状态、this 值等都会存在在栈上。当一个函数执行结束，那么该函数的执行上下文便会被销毁掉